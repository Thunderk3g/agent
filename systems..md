I need you to create a Python backend for an AI agent that manages the Bajaj Allianz eTouch II insurance product lifecycle. The system should implement a state machine pattern to handle customer interactions through different stages of the insurance process. The backend must connect to a locally running Ollama instance for natural language processing capabilities.  

The state machine should include these core states: Onboarding, EligibilityCheck, QuoteGeneration, Underwriting, PolicyIssuance, ActivePolicy, ClaimsProcessing, and ClosedPolicy. Additionally, implement sub-states for PremiumHoliday and DocumentCollection. Each state should have specific behaviors and transition logic. For example, the Onboarding state should collect KYC documents like PAN and Aadhar, while the QuoteGeneration state should calculate insurance premiums based on customer data and explain policy variants like Life Shield, Life Shield Plus, and Life Shield ROP. 

The system must integrate with Ollama running locally at http://localhost:11434 . Use the Llama 3 or Mistral model for processing natural language inputs and generating responses. The Ollama service should handle state-specific prompts, document analysis for KYC verification, insurance terminology explanations, and policy recommendations. Implement proper error handling for when Ollama is unavailable, including fallback responses and retry mechanisms. 

Create a FastAPI-based API layer with endpoints for starting new sessions, processing user messages, retrieving current state, uploading documents, retrieving quotes, and submitting claims. The API should maintain session context and manage state transitions based on user interactions. Each endpoint should validate inputs, process requests through the state machine, and return appropriate responses to the frontend. 

Structure the code with clear separation of concerns. Implement a StateMachine class to manage transitions between states. Create an OllamaService class to handle communication with the local Ollama instance. Design the API layer using FastAPI with Pydantic models for request/response validation. Include proper logging throughout the application to track state transitions and system behavior. 

For dependencies, use FastAPI for the web framework, httpx for asynchronous HTTP requests to Ollama, Pydantic for data validation, and python-multipart for handling file uploads. The system should be configurable through environment variables for Ollama connection details and model selection. 

Focus on implementing the core workflow first: a customer starts in Onboarding, provides KYC information, moves through eligibility checks and quote generation, completes underwriting, receives their policy, and then enters the ActivePolicy state where they can manage their policy or submit claims. Handle the PremiumHoliday feature that allows customers to temporarily suspend premium payments while maintaining coverage. 

Ensure the system can handle document uploads for KYC verification and claims processing. Implement logic to analyze these documents using Ollama where appropriate, such as extracting information from ID cards or medical reports. The system should maintain context across user sessions to provide personalized assistance throughout the insurance lifecycle. 

Include comprehensive error handling for all components, with appropriate HTTP status codes and error messages. Implement validation for state transitions to prevent invalid moves. The system should be resilient to temporary unavailability of Ollama, with graceful degradation of functionality when necessary.
